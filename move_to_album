#! /usr/bin/env bash

set -e

export PATH="$(dirname "$(readlink -e "$0")"):$PATH"
declare -r MOVE_PHOTOS="$(dirname $(readlink -e $0))/lib/move_photos.sh"

while getopts "r" opt; do
    case $opt in
        r ) declare -r RENAME_PHOTOS=;;
	esac
done
shift $(expr $OPTIND - 1)

declare -r TARGET_ALBUM_PATH=$(readlink -f "$1")

if [[ -z $TARGET_ALBUM_PATH ]]; then
    echo "Path of target album directory does not exist" >&2
    exit 1
elif ! [[ -d $TARGET_ALBUM_PATH ]]; then
    echo "Path of target directory is not a directory" >&2
    exit 1
fi

declare -r TARGET_ALBUM_NAME=$(basename "$TARGET_ALBUM_PATH")
declare -r TARGET_DIRECTORY_ROOT=$(dirname "$(dirname "$TARGET_ALBUM_PATH")")

shift 1
declare -r PHOTOS_TO_MOVE=$@

declare -r RENAME_MODE=$(test -v RENAME_PHOTOS && echo "b" || echo "a")

set -u

"$MOVE_PHOTOS" -r "$TARGET_ALBUM_NAME" -m $RENAME_MODE $PHOTOS_TO_MOVE 
