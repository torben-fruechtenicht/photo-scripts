#! /usr/bin/env bash

set -e

export PATH="$(dirname "$(readlink -e "$0")"):$PATH"

while getopts "r" opt; do
    case $opt in
        r ) declare -r RENAME_PHOTOS=;;
	esac
done
shift $(expr $OPTIND - 1)

declare -r TARGET_ALBUM_PATH=$(readlink -f "$1")

if [[ -z $TARGET_ALBUM_PATH ]]; then
    echo "Path of target album directory does not exist" >&2
    exit 1
fi

declare -r TARGET_ALBUM_NAME=$(basename "$TARGET_ALBUM_PATH")
declare -r TARGET_DIRECTORY_ROOT=$(dirname "$(dirname "$TARGET_ALBUM_PATH")")

shift 1
declare -r PHOTOS_TO_MOVE=$@

declare -r RENAME_MODE=$(test -v RENAME_PHOTOS && echo "b" || echo "a")

set -u

# TBD FIXME can't we just say that moving to another album stays in the directory hierarchy? I.e. moves will always happen
# in the incoming or archive directories? This would mean we no have to pass TARGET_DIRECTORY_ROOT here
move_photos -t "$TARGET_DIRECTORY_ROOT" -r "$TARGET_ALBUM_NAME" -m $RENAME_MODE $PHOTOS_TO_MOVE 
